---
title: On the optimality of Optimistic Responsiveness
date: 2020-05-16 01:10:00 -07:00
tags:
- blockchain 101
- SMR
- research
author: Kartik Nayak, Nibesh Shrestha
published: true
---

A consensus protocol is said to be *responsive* if it commits at the speed of actual network latency $\delta$. Asynchronous and 
partially synchronous consensus protocols are *responsive* by design, but have lower fault tolerance. On the other hand, the commit latency of synchronous consensus protocols
depend on the pessimistic network latency $\Delta$, but have higher fault tolerance. [Thunderella](https://link.springer.com/chapter/10.1007/978-3-319-78375-8_1)
introduced the notion of *optimistic responsiveness* that allows synchronous protocols to commit in $O(\delta)$ time when
certain optimistic conditions are met. Some protocols under this notion of *optimistic responsiveness* include Thunderella and 
[Sync HotStuff](https://eprint.iacr.org/2019/270.pdf). In general, the protocols following this paradigm include two distinct 
commit paths: (i) a fast optimistic commit path with a commit latency of $O(\delta)$, and (ii) a slow synchronous commit path with a commit latency of 
$O(\Delta)$. The optimistic path requires an honest leader and $>3n/4$ honest replicas. The replicas, in the protocol, 
must explicitly know which of the commit paths they are in. When optimistic conditions are met, the replicas make an explicit
switch to the fast path and switch back to the slow path when no progress is seen in the fast path. Each switch incurs a latency of at least $\Delta$.
     
While the protocols commit *responsively* during optimistic conditions, an adversary, under minority Byzantine faults, can attack such a strategy to worsen
the commit latency compared to a protocol with a single slow path. For example, when the protocol is in slow path, the 
adversary responds promptly and the replicas receive $> 3n/4$ responses thereby triggering a switch to fast path. Once in
the fast path, the adversary stops responding and prevents progress. This forces an explicit switch to the slow path, incurs switching latency in between and worsens the overall commit latency.

To address these concerns, we present three *optimistically responsive* protocols whose fast path and slow paths are active simultaneously
and thus no explicit switch is required. Replicas commit responsively when optimistic conditions are met and commit synchronously otherwise.
In this article, we discuss one such protocol.

## OptSync: Optimal Optimistic Responsiveness with $2\Delta$ synchronous latency
Our first protocol, OptSync, commits responsively with a commit latency of $O(\delta)$ when the leader and $>3n/4$ replicas are honest and commit synchronously with a latency of $2\Delta$.
OptSync works in [steady-state-and-view-change](https://decentralizedthoughts.github.io/2019-10-15-consensus-for-state-machine-replication/) paradigm with a single leader until an equivocation or no progress is detected.
A view-change protocol is executed to elect a new leader and ensure safety when the current leader fails to make progress.
We present core consensus protocol of OptSync in the steady-state.

1. **Propose.** The leader proposes a command *cmd*.  
2. **Vote.** On receiving the first valid proposal from the leader, a replica broadcasts a *vote* for *cmd* and forwards the leader proposal to all other replicas.  
3. **Commit.**  
  (i) **Responsive Commit.** If a replica receives $\lfloor 3n/4 \rfloor + 1$ *votes* for *cmd* and no equivocating proposals, commit *cmd* immediately. Notify commit to all replicas.    
  (ii) **Synchronous Commit.** If a replica does not detect an equivocation within $2\Delta$ time after voting, commit *cmd*.  
 
A replica commits *responsively* when it receives a *responsive quorum* of votes, i.e., $\lfloor 3n/4 \rfloor + 1$ for *cmd* (*responsive certificate*) and has not detected any equivocation.
Similarly, a replica *r* synchronously commits *cmd* if it does not detect an equivocation within $2\Delta$ time after voting. In this case, replica *r* receives at least a *synchronous quorum* of $f+1$ votes for *cmd* (*synchronous certificate*).
We note that a *responsive quorum* for *cmd* and a *synchronous quorum* for *cmd'* does not necessarily intersect at an honest replica. However, if there exists a *responsive quorum* for *cmd*, *cmd'* cannot be synchronously committed. Below we explain why this is the case.

<p align="center">
<img src="/uploads/optsync.png" width="512" title="A responsive commit implies an equivocating synchronous commit cannot occur">
</p>

Suppose an honest replica *r* commits *cmd* *responsively* at time *t*. This implies two things (i) no honest replica has voted for a conflicting command *cmd'* before time $t-\Delta$, and (ii) all honest replicas will hear a vote for *cmd* by time $t+\Delta$.
The earliest an honest replica *r'* could have voted for *cmd'* is at time $t'$ such that $t-\Delta \le t' \le t$. Since, replica $r'$ learns *cmd* by time $t+\Delta \le $t' + 2\Delta$, it would not commit *cmd'* synchronously. 
Additionally, since a responsive quorum requires $\lfloor 3n/4 \rfloor + 1$ votes, two responsive quorums intersect at least one honest replica. Thus, no conflicting command could get committed responsively.

The above explanation suffices to argue why two conflicting commands cannot be committed at same log position. Within a state machine replication (SMR) setting,
replicas keep voting and committing new commands by extending on previously proposed commands thus forming a linear chain of commands. As we just saw, there could exist a *responsive certificate* and a *synchronous certificate* for conflicting commands.
As a result, there could be conflicting chains extending from conflicting *responsive* and *synchronous* certificates. We resolve this conflict by proposing a novel chain ranking rule that ranks *responsive certificates* higher than *synchronous certificates*
We refer the readers to our [paper](https://eprint.iacr.org/2020/458.pdf) for more details on chain ranking and complete protocol specification.
 
In the paper, we also present an optimal optimistic responsive protocol with only $\Delta$ synchronous latency. This protocol requires all $n$ replicas to be honest to commit responsively.
Both of the above protocols include a synchronous wait during view-change when the current leader is replaced by a new leader.
Our third protocol presents an optimistically responsive view-change protocol and allows replicas to transition to a higher view with a latency of $O(\delta)$ during optimistic conditions.

This protocol is a joint work with [Ittai](https://research.vmware.com/researchers/ittai-abraham) and [Ling](https://sites.google.com/view/renling). Read more about it [here](https://eprint.iacr.org/2020/458.pdf).